<div id="visibility-buttons">
  <div class="flex-container with-bottom-border">
    <p>All Connectors</p>
    <div class="left-gap">
      <button id="show-all">Show</button>
      <button id="hide-all">Hide</button>
    </div>
  </div>
  <div class="flex-container with-bottom-border">
    <input type="text" placeholder="Flow 1" id="flow-name-1" onchange="newFlowName(0)">
    <div class="left-gap">
      <button id="show-flow-1">Filter</button>
    </div>
  </div>
  <div class="flex-container with-bottom-border">
    <input type="text" placeholder="Flow 2" id="flow-name-2" onchange="newFlowName(1)">
    <div class="left-gap">
      <button id="show-flow-2">Filter</button>
    </div>
  </div>
  <div class="flex-container with-bottom-border">
    <input type="text" placeholder="Flow 3" id="flow-name-3" onchange="newFlowName(2)">
    <div class="left-gap">
      <button id="show-flow-3">Filter</button>
    </div>
  </div>
  <div class="flex-container">
    <p>Include Locked Connectors</p>
    <label class="switch">
      <input type="checkbox" onchange="Check(this)">
      <span class="slider round" id="verdict"></span>
    </label>
  </div>
</div>
<div id="select-tags">
  <div class="flex-container with-bottom-border">
    <p id="readonly-name-1">Flow 1</p>
    <div class="left-gap">
      <div class="checkmark" id="checkmark-1">
        <svg width="15" height="15" viewBox="0 0 15 15" fill="#4EC032" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M11.4669 3.72684C11.7558 3.91574 11.8369 4.30308 11.648 4.59198L7.39799 11.092C7.29783 11.2452 7.13556 11.3467 6.95402 11.3699C6.77247 11.3931 6.58989 11.3355 6.45446 11.2124L3.70446 8.71241C3.44905 8.48022 3.43023 8.08494 3.66242 7.82953C3.89461 7.57412 4.28989 7.55529 4.5453 7.78749L6.75292 9.79441L10.6018 3.90792C10.7907 3.61902 11.178 3.53795 11.4669 3.72684Z"
            fill="#4EC032" fill-rule="evenodd" clip-rule="evenodd"></path>
        </svg>
      </div>
      <button id="tag-arrows-1">Add</button>
    </div>
  </div>
  <div class="flex-container with-bottom-border">
    <p id="readonly-name-2">Flow 2</p>
    <div class="left-gap">
      <div class="checkmark" id="checkmark-2">
        <svg width="15" height="15" viewBox="0 0 15 15" fill="#4EC032" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M11.4669 3.72684C11.7558 3.91574 11.8369 4.30308 11.648 4.59198L7.39799 11.092C7.29783 11.2452 7.13556 11.3467 6.95402 11.3699C6.77247 11.3931 6.58989 11.3355 6.45446 11.2124L3.70446 8.71241C3.44905 8.48022 3.43023 8.08494 3.66242 7.82953C3.89461 7.57412 4.28989 7.55529 4.5453 7.78749L6.75292 9.79441L10.6018 3.90792C10.7907 3.61902 11.178 3.53795 11.4669 3.72684Z"
            fill="#4EC032" fill-rule="evenodd" clip-rule="evenodd"></path>
        </svg>
      </div>
      <button id="tag-arrows-2">Add</button>
    </div>
  </div>
  <div class="flex-container with-bottom-border">
    <p id="readonly-name-3">Flow 3</p>
    <div class="left-gap">
      <div class="checkmark" id="checkmark-3">
        <svg width="15" height="15" viewBox="0 0 15 15" fill="#4EC032" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M11.4669 3.72684C11.7558 3.91574 11.8369 4.30308 11.648 4.59198L7.39799 11.092C7.29783 11.2452 7.13556 11.3467 6.95402 11.3699C6.77247 11.3931 6.58989 11.3355 6.45446 11.2124L3.70446 8.71241C3.44905 8.48022 3.43023 8.08494 3.66242 7.82953C3.89461 7.57412 4.28989 7.55529 4.5453 7.78749L6.75292 9.79441L10.6018 3.90792C10.7907 3.61902 11.178 3.53795 11.4669 3.72684Z"
            fill="#4EC032" fill-rule="evenodd" clip-rule="evenodd"></path>
        </svg>
      </div>
      <button id="tag-arrows-3">Add</button>
    </div>
  </div>
  <div class="flex-container with-bottom-border">
    <p>Remove Flow</p>
    <div class="left-gap">
      <button id="tag-arrows-null">Reset</button>
    </div>
  </div>
</div>
<style>

.figma-light body,
  .figma-dark body {
    background-color: var(--figma-color-bg);
    color: var(--figma-color-text);
  }

  p,
  button {
    font-family: 'Inter', 'Roboto', sans-serif;
    font-size: 12px;
  }

  button {
    -webkit-appearance: none;
    border: none;
    border-radius: 16px;
    color: #4EC032;
    height: 24px;
    padding: 4px 9px;
    background-color: transparent;
    border: 1px solid #ebebeb;
  }

  button:hover {
    background-color: #ebebeb;
  }

  input[type=text] {
    font-family: 'Inter', 'Roboto', sans-serif;
    font-size: 12px;
    -webkit-appearance: none;
    border: none;
    border-bottom: 1px solid lightgray;
    text-overflow: ellipsis;
    border-radius: 0;
    background-color: var(--figma-color-bg);
    color: var(--figma-color-text);
  }

  input[type=text]:focus {
    -webkit-appearance: none;
    border: none;
    border-bottom: 1px solid #4EC032;
    outline: none;
  }

  button:active {
    background-color: rgb(209, 209, 209);
  }

  .flex-container {
    align-items: center;
    display: flex;
    height: 40px;
    justify-content: space-between;
  }

  .with-extra-height {
    height: 60px !important;
  }

  .with-bottom-border {
    border-bottom: 0px solid #ebebeb;
  }

  .left-gap {
    margin-left: auto;
  }

  #select-tags {
    display: none;
  }

  /* CSS from https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_switch */

  .switch {
    position: relative;
    display: inline-block;
    width: 48px;
    height: 24px;
  }

  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    -webkit-transition: .4s;
    transition: .4s;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 2px;
    bottom: 2px;
    background-color: white;
    -webkit-transition: .4s;
    transition: .4s;
  }

  input:checked+.slider {
    background-color: #4EC032;
  }

  input:focus+.slider {
    box-shadow: 0 0 1px #4EC032;
  }

  input:checked+.slider:before {
    -webkit-transform: translateX(24px);
    -ms-transform: translateX(24px);
    transform: translateX(24px);
  }

  /* Rounded sliders */
  .slider.round {
    border-radius: 34px;
  }

  .slider.round:before {
    border-radius: 50%;
  }
</style>
<script>

  var selectedFlowString = "NONE";

  var flowNames = [];

  document.getElementById('show-all').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'show-all' } }, '*')
  }

  document.getElementById('hide-all').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'hide-all' } }, '*')
  }

  document.getElementById('show-flow-1').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'show-flow-1' } }, '*')
  }

  document.getElementById('show-flow-2').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'show-flow-2' } }, '*')
  }

  document.getElementById('show-flow-3').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'show-flow-3' } }, '*')
  }

  document.getElementById('tag-arrows-1').onclick = () => {
    toggleCheckmark('1');
    parent.postMessage({ pluginMessage: { type: 'tag-arrows-1' } }, '*')
  }

  document.getElementById('tag-arrows-2').onclick = () => {
    toggleCheckmark('2');
    parent.postMessage({ pluginMessage: { type: 'tag-arrows-2' } }, '*')
  }

  document.getElementById('tag-arrows-3').onclick = () => {
    toggleCheckmark('3');
    parent.postMessage({ pluginMessage: { type: 'tag-arrows-3' } }, '*')
  }

  document.getElementById('tag-arrows-null').onclick = () => {
    toggleCheckmark('MIXED');
    parent.postMessage({ pluginMessage: { type: 'tag-arrows-null' } }, '*')
  }

  onmessage = (event) => {

    if (event.data.pluginMessage.text == 'show-visibility-buttons') {
      document.getElementById('visibility-buttons').style.display = 'block';
      document.getElementById('select-tags').style.display = 'none';
    }

    if (event.data.pluginMessage.text == 'show-select-tags') {
      document.getElementById('visibility-buttons').style.display = 'none';
      document.getElementById('select-tags').style.display = 'block';
      toggleCheckmark(event.data.pluginMessage.currentlySelectedFlow);
    }

    if (event.data.pluginMessage.text == 'show-no-connector-alert') {
      alert('Flow Show did not detect any arrow connectors in this file.');
    }

    if (event.data.pluginMessage.text == 'initialize-flow-names') {
      flowNames = event.data.pluginMessage.flowArray;
      loadFlowNames();
    }

  }

  function newFlowName(i) {
    const idString = 'flow-name-' + (i + 1);
    const rawValue = document.getElementById(idString).value;
    const trimmedValue = rawValue.replace(/,/g,"");
    flowNames[i] = trimmedValue;
    console.log(trimmedValue);
    document.getElementById(idString).value = trimmedValue;

    if (flowNames[i].length < 1) {
      flowNames[i] = "Flow " + (i + 1);
    }

    // Strip commas from flow name, because that is the delimiter we're using
    document.getElementById('readonly-name-1').innerText = flowNames[0];
    document.getElementById('readonly-name-2').innerText = flowNames[1];
    document.getElementById('readonly-name-3').innerText = flowNames[2];

    parent.postMessage({ pluginMessage: { type: 'save-flow-names' , nameArray: flowNames } }, '*');
  }

  function loadFlowNames() {
    for (let i = 0; i < flowNames.length; i++) {
      const inputName = 'flow-name-' + (i + 1);
      const readonlyName = 'readonly-name-' + (i + 1);

      if (flowNames[i].length < 1) {
        flowNames[i] = "Flow " + (i + 1);
      }

      document.getElementById(inputName).value = flowNames[i];
      document.getElementById(readonlyName).innerText = flowNames[i];
    }
  }

  function Check(value) {
    if (value.checked === true) {
      parent.postMessage({ pluginMessage: { type: 'include-locked-true' } }, '*');
    } else {
      parent.postMessage({ pluginMessage: { type: 'include-locked-false' } }, '*');
    }
  };

  function resetCheckmark() {
    document.getElementById('tag-arrows-1').style.display = 'block';
    document.getElementById('tag-arrows-2').style.display = 'block';
    document.getElementById('tag-arrows-3').style.display = 'block';
    document.getElementById('checkmark-1').style.display = 'block';
    document.getElementById('checkmark-2').style.display = 'block';
    document.getElementById('checkmark-3').style.display = 'block';
  }

  function toggleCheckmark(tagString) {
    resetCheckmark();

    if (tagString === '1') {
      document.getElementById('tag-arrows-1').style.display = 'none';
      document.getElementById('checkmark-2').style.display = 'none';
      document.getElementById('checkmark-3').style.display = 'none';
    } else if (tagString === '2') {
      document.getElementById('checkmark-1').style.display = 'none';
      document.getElementById('tag-arrows-2').style.display = 'none';
      document.getElementById('checkmark-3').style.display = 'none';
    } else if (tagString === '3') {
      document.getElementById('checkmark-1').style.display = 'none';
      document.getElementById('checkmark-2').style.display = 'none';
      document.getElementById('tag-arrows-3').style.display = 'none';
    } else {
      document.getElementById('checkmark-1').style.display = 'none';
      document.getElementById('checkmark-2').style.display = 'none';
      document.getElementById('checkmark-3').style.display = 'none';
    }
  }

</script>